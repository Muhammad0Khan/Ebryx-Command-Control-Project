<!DOCTYPE html>
<html lang="en">
	<head>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
			crossorigin="anonymous" />
		{% comment %}
		<link rel="stylesheet" href="{% static 'css/styles.css' %}" />
		{% endcomment %}
		<!-- Your custom styles -->
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>User Profile</title>
		<script>
			setTimeout(function () {
				location.reload();
			}, 5000);
		</script>
	</head>
	<body class="bg-light">
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<div class="container">
				<a class="navbar-brand" href="#">My App</a>
				<button
					class="navbar-toggler"
					type="button"
					data-toggle="collapse"
					data-target="#navbarNav"
					aria-controls="navbarNav"
					aria-expanded="false"
					aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav ml-auto">
						{% if user.is_authenticated %}
						<li class="nav-item">
							<a class="nav-link" href="{% url 'logout' %}">Logout</a>
						</li>
						{% else %}
						<li class="nav-item">
							<a class="nav-link" href="{% url 'login' %}">Login</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{% url 'signup' %}">Signup</a>
						</li>
						{% endif %}
					</ul>
				</div>
			</div>
		</nav>

		<div class="container mt-4">
			<h1>User Profile</h1>
			<p><strong>User :</strong> {{ user }}</p>
			<ul class="list-group">
				<li class="list-group-item"><strong>Status:</strong> {{ status }}</li>
				<li class="list-group-item">
					<strong>Remote IP:</strong> {{ remote_ip }}
				</li>
				<li class="list-group-item"><strong>PC Name:</strong> {{ pc_name }}</li>
				<li class="list-group-item">
					<strong>Timestamp:</strong> {{ timestamp }}
				</li>
				<li class="list-group-item">
					<strong>CPU Count:</strong> {{ cpu_count }}
				</li>
				<li class="list-group-item">
					<strong>CPU Usage:</strong> {{ cpu_percent }}%
				</li>
				<li class="list-group-item">
					<strong>CPU Frequency:</strong> {{ cpu_freq_value }} MHz
				</li>
				<li class="list-group-item"><strong>Threads:</strong> {{ threads }}</li>
				<li class="list-group-item">
					<strong>Per CPU Usage:</strong> {{ per_cpu_percent }}
				</li>
			</ul>

			<div style="width: 80%; margin: auto">
				<canvas id="cpuChart"></canvas>
			</div>

			<script>
				// Mock data for the last 4 hours
				const hours = Array.from(
					{ length: 4 },
					(_, i) => (new Date().getHours() - i + 24) % 24
				);
				const cpuData = Array.from({ length: 4 }, () => getRandomInt(50, 100));

				// Function to generate random integer between min and max
				function getRandomInt(min, max) {
					return Math.floor(Math.random() * (max - min + 1)) + min;
				}

				// Create the chart
				const ctx = document.getElementById("cpuChart").getContext("2d");
				const cpuChart = new Chart(ctx, {
					type: "line",
					data: {
						labels: hours,
						datasets: [
							{
								label: "CPU Usage",
								borderColor: "rgb(75, 192, 192)",
								data: cpuData,
								fill: false,
							},
						],
					},
					options: {
						scales: {
							x: {
								type: "linear",
								position: "bottom",
								title: {
									display: true,
									text: "By Hour",
								},
							},
							y: {
								min: 50,
								max: 100,
								title: {
									display: true,
									text: "CPU Usage (%)",
								},
							},
						},
					},
				});
			</script>

			<!-- Logout Button -->
			<form action="{% url 'logout' %}" method="post">
				{% csrf_token %}
				<button type="submit" class="btn btn-danger mt-3">Logout</button>
			</form>
		</div>

		<!-- Optional: Include your custom JavaScript files or Bootstrap JavaScript files here -->
	</body>
</html>
