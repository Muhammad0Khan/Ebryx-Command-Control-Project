{% extends 'base.html' %} {% block content %}
<style>
		table {
		    border-collapse: collapse;
		    width: 100%;
		}

		th, td {
		    border: 1px solid #dddddd;
		    text-align: left;
		    padding: 8px;
		}

		th {
		    background-color: #4CAF50;
		    color: white;
		}

		.status {
		    font-weight: bold;
		    color: {% if token.status == 'online' %}green{% else %}red{% endif %};
		}

		.button-primary {
		    background-color: #4CAF50;
		    color: white;
		    padding: 8px 16px;
		    border-radius: 4px;
		    cursor: pointer;
		}
		.button-delete {
		background-color: #f44336;
		color: white;
		padding: 8px 16px;
		border-radius: 4px;
		cursor: pointer;
		margin-left: 10px;
	}
</style>

<h1>System Dashboard</h1>
<table>
	<thead>
		<tr>
			<th>Token</th>
			<th>Status</th>
			<th>Details</th>
			<th>Delete</th>
		</tr>
	</thead>
	<tbody id="tokenTableBody">
		{% for token in tokens %}
		<tr>
			<td>{{ token.token }}</td>
			<td class="status">
				{% if token.status == 'online' %}Online{% else %}Offline{% endif %}
			</td>
			<td>
				<a href="{{ token.details_url }}">
					<button class="button-primary">Details</button>
				</a>
			</td>
			<td>
				<button
					class="button-delete"
					onclick="deleteToken('{{ token.token }}')">
					Delete
				</button>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>

<script>
	// Reload data every 5 seconds
	setInterval(function () {
		fetch("/dashboard/") // Replace with the actual URL of your dashboard view
			.then(response => response.text())
			.then(html => {
				const parser = new DOMParser();
				const newDoc = parser.parseFromString(html, "text/html");
				const newTableBody = newDoc.getElementById("tokenTableBody");
				document.getElementById("tokenTableBody").innerHTML =
					newTableBody.innerHTML;
			})
			.catch(error => console.error("Error fetching data:", error));
	}, 5000);

	// Function to delete a token
	function deleteToken(token) {
		fetch(`/api/delete_token/${token}/`, {
			method: "DELETE",
		})
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					console.log(data.message);
					// Optionally, update the UI or take additional actions upon successful deletion
				} else {
					console.error(data.message);
					// Handle the case where deletion was not successful
				}
			})
			.catch(error => console.error("Error deleting token:", error));
	}
</script>
{% endblock %}
