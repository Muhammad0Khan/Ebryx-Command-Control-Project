{% extends 'dashboard_base.html' %} {% block content %}
<style>
	table {
		border-collapse: collapse;
		width: 100%;
		background-color: #ffffff; /* Light background color */
		color: #000000; /* Dark text color */
		border-radius: 6px; /* Rounded corners */
		overflow: hidden; /* Ensure rounded corners are visible */
	}

	th,
	td {
		background-color: #252525; /* Light background color for header */
		color: #bdbdbd; /* Dark text color for header */
		
		text-align: left;
		padding: 12px;
	}

	tr {
		border: 1px solid #444444; /* Light border color */
	}
	th {
		background-color: #252525; /* Light background color for header */
		color: #bdbdbd; /* Dark text color for header */
	}

	.status {
		font-weight: bold;
	}
</style>

<div class="mt-4">
	<div class="">
		<h1>CPU Information Dashboard</h1>
		<nav>
			<ol class="breadcrumb">
				<li class="breadcrumb-item">
					<a href="{% url 'dashboard' %}">Dashboard</a>
				</li>
			</ol>
		</nav>
	</div>

	<div class="card">
		<div class="card-body">
			<table class="mt-4">
				<thead>
					<tr>
						<th>Host Name</th>
						<th>User Name</th>

						<th>Token</th>
						<th>Status</th>
						<th>Details</th>
					</tr>
				</thead>
				<tbody id="tokenTableBody">
					{% for token in tokens %}
					<tr>
						<td>{{ token.system_data.hostname }}</td>
						<td>{{ token.system_data.username }}</td>
						<td>{{ token.token }}</td>

						<td
							class="status"
							style="color: {% if token.status == 'online' %}#28a745{% else %}#dc3545{% endif %};">
							{% if token.status == 'online' %}Online{% else %}Offline{% endif%}
						</td>
						<td>
							<a href="{{ token.hardware_info }}">
											<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="filter: invert(1); width: 20px; height: 20px;">
												<path d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM288 96a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM256 416c35.3 0 64-28.7 64-64c0-17.4-6.9-33.1-18.1-44.6L366 161.7c5.3-12.1-.2-26.3-12.3-31.6s-26.3 .2-31.6 12.3L257.9 288c-.6 0-1.3 0-1.9 0c-35.3 0-64 28.7-64 64s28.7 64 64 64zM176 144a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM96 288a32 32 0 1 0 0-64 32 32 0 1 0 0 64zm352-32a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/>
											</svg>
											CPU Stats
							</a>
					</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-4">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title text-center">CPU TRENDS</h5>					
				</div>

				<div class= "mb-4">
					<h4 class="text-center" style="color: #bdbdbd">
						Average Core Count : {{avg_count}}
					</h4>
					<h4 class="text-center" style="color: #bdbdbd">
						Average Frequency (MHZ) : {{avg_freq}}
					</h4>
				</div>
			</div>
		</div>

		<div class="col-lg-4">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title text-center">RAM TRENDS</h5>
				</div>
				<div class= "mb-4">
					<h4 class="text-center" style="color: #bdbdbd">
						Average SWAP : {{ram_avg_swap}}
					</h4>
					<h4 class="text-center" style="color: #bdbdbd">
						Average Memory Size (MB) : {{ram_avg_size}}
					</h4>
				</div>
			</div>
		</div>

		<div class="col-lg-4">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title text-center">DISK TRENDS</h5>											
				</div>
				<div class= "mb-4">
					<h4 class="text-center" style="color: #bdbdbd">
						Average Disk Used : {{total_disk_size}}
					</h4>
					<h4 class="text-center" style="color: #bdbdbd">
						Average Disk Size (GB) : {{total_disk_usage}}
					</h4>
				</div>
			</div>
		</div>

	</div>


	<div class="row" >
		<div class="col-lg-4 " style="height=350px;">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title text-center">AVG CPU LOAD</h5>
					<div>
						<canvas id="TD1" width="400" height="175"></canvas>
					</div>
					<h4 class="text-center" style="margin-top: -10px">{{avg_usage}}%</h4>
				</div>
						</div>
		</div>

		<div class="col-lg-4">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title text-center">AVG RAM LOAD</h5>
					<div>
						<canvas id="TD2" width="400" height="175"></canvas>
					</div>
					<h4 class="text-center" style="margin-top: -10px">{{ram_avg_usage}}%</h4>		
				</div>
				
			</div>
		</div>

		<div class="col-lg-4">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title text-center">AVG DISK LOAD</h5>
					<div>
						<canvas id="TD3" width="400" height="175"></canvas>
					</div>
					<h4 class="text-center" style="margin-top: -10px">{{total_disk_usage}}%</h4>		
				</div>
				
			</div>
		</div>

	</div>


	<script>
		// Reload data every 5 seconds
		setInterval(function () {
			fetch("/hardware_dashboard/") // Replace with the actual URL of your dashboard view
				.then(response => response.text())
				.then(html => {
					const parser = new DOMParser();
					const newDoc = parser.parseFromString(html, "text/html");
					const newTableBody = newDoc.getElementById("tokenTableBody");
					document.getElementById("tokenTableBody").innerHTML =
						newTableBody.innerHTML;
				})
				.catch(error => console.error("Error fetching data:", error));
		}, 5000);
	</script>


	{% comment %} half donut cpu {% endcomment %}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
		var cpuUsage = {{ avg_usage }};

		var backgroundColor;
		if (cpuUsage <=100){
			backgroundColor = "#f87979"; // Red for more than 66%
		}
		if (cpuUsage <=66) {
		    backgroundColor = "#ffce56"; // Yellow for 33% to 66%
		}
		if (cpuUsage <= 33) {
		    backgroundColor = "#36a2eb"; // Blue for less than 33%
		}

		 var data = {
			labels: ["Used", "Unused"],

		        datasets: [{
		            data: [cpuUsage, 100 - cpuUsage],
		            backgroundColor: [backgroundColor, "#bdbdbd"],
						borderWidth: 0,
		        }]
		    };

		    var ctx = document.getElementById('TD1').getContext('2d');
		    var myChart = new Chart(ctx, {
		        type: 'doughnut',
		        data: data,
		        options: {
		            cutout: '80%', // Adjust the cutout percentage to control the thickness of the donut
		        rotation: -Math.PI*35, // Start angle for the half donut
		        circumference: Math.PI*69.9, // Sweep angle for the half donut
		            responsive: true,
		            maintainAspectRatio: false,
						plugins:{
							legend: {
		                display: false
		            }
					}
		        }
		    });
		});
	</script>


	{% comment %} half donut ram {% endcomment %}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
		var cpuUsage = {{ ram_avg_usage }};

		var backgroundColor;
		if (cpuUsage <=100){
			backgroundColor = "#f87979"; // Red for more than 66%
		}
		if (cpuUsage <=66) {
		    backgroundColor = "#ffce56"; // Yellow for 33% to 66%
		}
		if (cpuUsage <= 33) {
		    backgroundColor = "#36a2eb"; // Blue for less than 33%
		}

		 var data = {
			labels: ["Used", "Unused"],

		        datasets: [{
		            data: [cpuUsage, 100 - cpuUsage],
		            backgroundColor: [backgroundColor, "#bdbdbd"],
						borderWidth: 0,
		        }]
		    };

		    var ctx = document.getElementById('TD2').getContext('2d');
		    var myChart = new Chart(ctx, {
		        type: 'doughnut',
		        data: data,
		        options: {
		            cutout: '80%', // Adjust the cutout percentage to control the thickness of the donut
		        rotation: -Math.PI*35, // Start angle for the half donut
		        circumference: Math.PI*69.9, // Sweep angle for the half donut
		            responsive: true,
		            maintainAspectRatio: false,
						plugins:{
							legend: {
		                display: false
		            }
					}
		        }
		    });
		});
	</script>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
		var cpuUsage = {{ total_disk_usage }};

		var backgroundColor;
		if (cpuUsage <=100){
			backgroundColor = "#f87979"; // Red for more than 66%
		}
		if (cpuUsage <=66) {
		    backgroundColor = "#ffce56"; // Yellow for 33% to 66%
		}
		if (cpuUsage <= 33) {
		    backgroundColor = "#36a2eb"; // Blue for less than 33%
		}

		 var data = {
			labels: ["Used", "Unused"],

		        datasets: [{
		            data: [cpuUsage, 100 - cpuUsage],
		            backgroundColor: [backgroundColor, "#bdbdbd"],
						borderWidth: 0,
		        }]
		    };

		    var ctx = document.getElementById('TD3').getContext('2d');
		    var myChart = new Chart(ctx, {
		        type: 'doughnut',
		        data: data,
		        options: {
		            cutout: '80%', // Adjust the cutout percentage to control the thickness of the donut
		        rotation: -Math.PI*35, // Start angle for the half donut
		        circumference: Math.PI*69.9, // Sweep angle for the half donut
		            responsive: true,
		            maintainAspectRatio: false,
						plugins:{
							legend: {
		                display: false
		            }
					}
		        }
		    });
		});
	</script>
</div>
{% endblock %}
